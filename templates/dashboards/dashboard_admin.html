{% extends 'base.html' %}
{% block title %}Dashboard Administrateur{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2 class="mb-0">Dashboard Administrateur</h2>
        <p class="text-muted">Gestion compl√®te de l'application</p>
    </div>
</div>

<!-- Statistiques -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title">Total Utilisateurs</h5>
                <h2 class="mb-0">{{ total_users }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">Total Recettes</h5>
                <h2 class="mb-0">{{ total_recipes }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h5 class="card-title">Chefs</h5>
                <h2 class="mb-0">{{ total_chefs }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Actions rapides -->
<div class="row mb-4">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Actions rapides</h5>
            </div>
            <div class="card-body">
                <a href="/admin/" class="btn btn-primary me-2" target="_blank">
                    Acc√©der √† l'administration Django
                </a>
                <a href="{% url 'recipes' %}" class="btn btn-secondary me-2">
                    Voir toutes les recettes
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Recettes r√©centes -->
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Recettes r√©centes</h5>
            </div>
            <div class="card-body">
                {% if recent_recipes %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Jour</th>
                                <th>Description</th>
                                <th>Cr√©√©e par</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for recipe in recent_recipes %}
                            <tr>
                                <td>{{ recipe.name }}</td>
                                <td>{{ recipe.day }}</td>
                                <td>{{ recipe.description }}</td>
                                <td>{{ recipe.user.username|default:"Inconnu" }}</td>
                                <td>
                                    <a href="{% url 'update_recipe' recipe.id %}"
                                        class="btn btn-sm btn-outline-primary">Modifier</a>
                                    <a href="{% url 'delete_recipe' recipe.id %}"
                                        class="btn btn-sm btn-outline-danger">Supprimer</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">Aucune recette pour le moment.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<!-- Gestion des Utilisateurs -->
<div class="row mt-4 mb-4">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">üë• Gestion des Utilisateurs</h5>
                <span class="badge bg-light text-primary">{{ users.count }} inscrits</span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Utilisateur</th>
                                <th>Date d'inscription</th>
                                <th>R√¥le Actuel</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in users %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-light rounded-circle p-2 me-2 text-center"
                                            style="width: 40px; height: 40px;">
                                            üë§
                                        </div>
                                        <div>
                                            <strong>{{ u.username }}</strong><br>
                                            <small class="text-muted">{{ u.email|default:"Pas d'email" }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ u.date_joined|date:"d M Y" }}</td>
                                <td>
                                    {% if u.is_superuser %}
                                    <span class="badge bg-danger rounded-pill">Administrateur</span>
                                    {% elif u.groups.all.0.name == "chef" %}
                                    <span class="badge bg-success rounded-pill">üë®‚Äçüç≥ Chef</span>
                                    {% else %}
                                    <span class="badge bg-secondary rounded-pill">Utilisateur</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if not u.is_superuser %}
                                    {% if u.groups.all.0.name != "chef" %}
                                    <a href="{% url 'promote_to_chef' u.id %}" class="btn btn-sm btn-outline-primary">
                                        ‚¨ÜÔ∏è Promouvoir Chef
                                    </a>
                                    {% else %}
                                    <button class="btn btn-sm btn-success" disabled>‚úÖ D√©j√† Chef</button>
                                    {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}